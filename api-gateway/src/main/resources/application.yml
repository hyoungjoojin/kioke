server:
  port: ${API_GATEWAY_PORT}

spring:
  application:
    name: gateway

  cloud:
    gateway:
      discovery:
        locator:
          enabled: false
          lower-case-service-id: true

      default-filters:
        - RemoveRequestHeader=Kioke-Uid
        - RemoveRequestHeader=Kioke-Request-Id
        - RequestLoggingFilter

      routes:
        - id: Kioke Auth Service Login
          uri: lb://auth
          predicates:
            - Path=/auth/login
            - Method=POST

        - id: Kioke Auth Service Registration
          uri: lb://auth
          predicates:
            - Path=/auth/register
            - Method=POST

        - id: Kioke User Service Get Authenticated User Information
          uri: lb://user
          predicates:
            - Path=/users
            - Method=GET
          filters:
            - TokenAuthenticationFilter

        - id: Kioke User Service Get User Information
          uri: lb://user
          predicates:
            - Path=/users/{uid}
            - Method=GET
          filters:
            - TokenAuthenticationFilter

        - id: Kioke User Service Get Friends
          uri: lb://user
          predicates:
            - Path=/friends
            - Method=GET
          filters:
            - TokenAuthenticationFilter

        - id: Kioke User Service Add Friend
          uri: lb://user
          predicates:
            - Path=/friends
            - Method=POST
          filters:
            - TokenAuthenticationFilter

        - id: Kioke Journal Service Create Shelf
          uri: lb://journal
          predicates:
            - Path=/shelves
            - Method=POST
          filters:
            - TokenAuthenticationFilter

        - id: Kioke Journal Service Get Shelves
          uri: lb://journal
          predicates:
            - Path=/shelves
            - Method=GET
          filters:
            - TokenAuthenticationFilter

        - id: Kioke Journal Service Create Journal
          uri: lb://journal
          predicates:
            - Path=/journals
            - Method=POST
          filters:
            - TokenAuthenticationFilter

        - id: Kioke Journal Service Read Journal
          uri: lb://journal
          predicates:
            - Path=/journals/{jid}
            - Method=GET
          filters:
            - TokenAuthenticationFilter

eureka:
  instance:
    appname: gateway
    instance-id: ${spring.cloud.client.hostname}:${spring.application.name}:${spring.application.instance_id:${server.port}}
  client:
    register-with-eureka: true
    fetch-registry: true
